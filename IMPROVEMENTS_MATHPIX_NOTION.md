# Mathpix 및 Notion 업무 개선사항

## 발견된 문제점

### 1. 검증 로직 문제
- **문제**: 모든 문제에 대해 모든 검증을 수행하여 불필요한 경고 발생
  - 예: 포물선 문제인데도 타원 정의 검증 수행
  - 예: 해설이 일반적인 Drill 내용이라 문제별 구체적 해법이 아닐 수 있음
- **영향**: 실제 중요한 경고를 놓칠 수 있음

### 2. 문제-해설 매칭 문제
- **문제**: 문제 파일의 문제와 Notion의 문제를 정확히 매칭하지 못함
- **영향**: 잘못된 검증 결과

### 3. LaTeX 변환 문제
- **문제**: aligned 환경, 수식 블록 처리 시 일부 오류
- **영향**: Deepseek R1-70B가 읽기 어려운 형식

### 4. 원리공유문제/오답시나리오 생성 문제
- **문제**: 문제 유형별 특화 내용이 부족
- **영향**: 생성된 내용이 일반적임

### 5. 문제 번호 추출 문제 (P3, P4 작업 중 발견)
- **문제**: 비순차적 문제 번호 처리 (예: P4의 13, 11번)
  - 섹션 헤더에서 `(13)`, `(11)` 형식 추출은 되지만, JSON의 index와 매칭이 어려움
  - 문제ID에서 인덱스 추출 시 `P4_13` -> `13` 매칭이 제대로 안 될 수 있음
- **영향**: 잘못된 문제-해설 매칭

### 6. 원본 LaTeX 수식 오류 (P4 해설 작업 중 발견)
- **문제**: Mathpix 변환 시 잘못된 LaTeX 수식 생성
  - 예: `\left.\left|k \vec{a}+|\vec{b}|^{2}=k^{2}\right| \vec{a}\right|^{2}` (잘못된 형태)
  - 올바른 형태: `|k \vec{a}+l \vec{b}|^{2}=k^{2}|\vec{a}|^{2}+l^{2}|\vec{b}|^{2}+2kl(\vec{a} \cdot \vec{b})`
- **영향**: Deepseek이 잘못된 수식을 읽게 됨

### 7. 핵심개념 검증 과도한 경고 (P3, P4 작업 중 발견)
- **문제**: 핵심개념이 해설에 명시적으로 언급되지 않는다는 경고가 과도하게 발생
  - 해설이 일반적인 Drill 형식이라 특정 개념을 명시하지 않을 수 있음
  - 예: "타원의장단축과이심률", "공간직선의매개변수방정식" 등이 해설에 직접 언급되지 않음
- **영향**: 실제 문제가 아닌데도 경고가 많이 발생하여 중요한 경고를 놓칠 수 있음

### 8. 벡터 문제 처리 개선 필요 (P4 작업 중 발견)
- **문제**: 벡터 문제에 대한 특화된 검증 및 생성 로직이 추가되었지만, 더 세밀한 개선 필요
  - 벡터의 일차결합, 내적, 크기 제곱 등 다양한 패턴 처리
  - 원과 벡터를 결합하는 문제 처리
- **영향**: 벡터 문제의 정확한 검증 및 내용 생성이 어려움

## 개선 방안

### 1. 문제 유형별 검증 로직 분리
- 포물선 문제: 포물선 관련 검증만
- 타원 문제: 타원 관련 검증만
- 원 문제: 원 관련 검증만
- 벡터 문제: 벡터 관련 검증만 (추가됨)

### 2. 문제-해설 정확한 매칭
- 문제ID를 통해 정확한 문제 찾기
- 해당 문제의 내용만 검증
- **개선**: 비순차적 문제 번호 처리 개선 (섹션 헤더의 `(13)`, `(11)` 형식과 JSON index 매칭)

### 3. LaTeX 변환 개선
- aligned 환경 처리 개선
- 수식 블록 주변 공백 처리 개선
- **개선**: 원본 LaTeX 수식 오류 감지 및 자동 수정 로직 추가
  - 잘못된 `\left.\left|...` 패턴 감지
  - 벡터 크기 제곱 공식 자동 수정

### 4. 원리공유문제/오답시나리오 생성 개선
- 문제 유형별 특화 내용 생성
- 해설 내용을 더 적극적으로 활용
- **개선**: 벡터 문제에 대한 특화된 원리 및 오답 시나리오 생성 (추가됨)

### 5. 핵심개념 검증 완화 (신규)
- **방안**: 해설이 일반적인 Drill 형식임을 고려하여 검증 완화
  - 핵심개념이 해설에 직접 언급되지 않아도 관련 내용이 있으면 통과
  - 예: "타원의장단축과이심률"이 직접 언급되지 않아도 "타원", "장축", "단축" 등 관련 키워드가 있으면 통과
  - 문제 유형과 관련 없는 핵심개념은 검증 제외

### 6. 문제 번호 추출 개선 (신규)
- **방안**: 섹션 헤더의 다양한 형식 지원
  - `(13)`, `(11)` 형식: 괄호 안 숫자 추출
  - `13`, `11` 형식: 숫자만 추출
  - 문제ID와 JSON index 매칭 로직 개선
  - 문제 번호가 비순차적일 때도 정확히 매칭

### 7. LaTeX 수식 오류 자동 수정 (신규)
- **방안**: 잘못된 LaTeX 수식 패턴 감지 및 수정
  - `\left.\left|...` 패턴 감지 시 올바른 형태로 수정
  - 벡터 크기 제곱 공식 자동 수정
  - 수정 전후 비교 로그 출력

### 8. 벡터 문제 특화 처리 강화 (신규)
- **방안**: 벡터 문제에 대한 더 세밀한 처리
  - 벡터의 일차결합, 내적, 크기 제곱, 벡터방정식 등 패턴별 검증
  - 원과 벡터 결합 문제 특화 처리
  - 정사영과 내적 관련 검증 추가
- **개선**: 벡터 문제에 대한 특화된 원리 및 오답 시나리오 생성 (추가됨)

### 5. 핵심개념 검증 완화 (신규)
- **방안**: 해설이 일반적인 Drill 형식임을 고려하여 검증 완화
  - 핵심개념이 해설에 직접 언급되지 않아도 관련 내용이 있으면 통과
  - 예: "타원의장단축과이심률"이 직접 언급되지 않아도 "타원", "장축", "단축" 등 관련 키워드가 있으면 통과
  - 문제 유형과 관련 없는 핵심개념은 검증 제외

### 6. 문제 번호 추출 개선 (신규)
- **방안**: 섹션 헤더의 다양한 형식 지원
  - `(13)`, `(11)` 형식: 괄호 안 숫자 추출
  - `13`, `11` 형식: 숫자만 추출
  - 문제ID와 JSON index 매칭 로직 개선
  - 문제 번호가 비순차적일 때도 정확히 매칭

### 7. LaTeX 수식 오류 자동 수정 (신규)
- **방안**: 잘못된 LaTeX 수식 패턴 감지 및 수정
  - `\left.\left|...` 패턴 감지 시 올바른 형태로 수정
  - 벡터 크기 제곱 공식 자동 수정
  - 수정 전후 비교 로그 출력

### 8. 벡터 문제 특화 처리 강화 (신규)
- **방안**: 벡터 문제에 대한 더 세밀한 처리
  - 벡터의 일차결합, 내적, 크기 제곱, 벡터방정식 등 패턴별 검증
  - 원과 벡터 결합 문제 특화 처리
  - 정사영과 내적 관련 검증 추가
